# SA10: 데이트레이딩 분석

## 📋 명령어 정보

- **코드명**: SA10
- **명령어**: 데이트레이딩 분석
- **설명**: 일일 데이트레이딩 분석 및 리포트 생성

---

## ⚙️ 실행 모드

**자동 실행 모드**: ON
- **중요: 사용자에게 절대 중간에 질문하지 않음**
- **중요: 모든 단계를 중단 없이 연속으로 자동 실행**
- 사용자 확인 없이 모든 절차 자동 실행
- 중간 질문 없음 (날짜 선택, 데이터 확인 등 모두 자동 처리)
- 에러 발생 시에만 사용자에게 알림
- 완료 후 최종 결과만 요약해서 출력

**자동 Git 커밋**: ON
- 모든 분석 완료 후 자동으로 git add & commit 실행
- 사용자 확인 없이 자동 커밋

---

## 📝 실행 절차

### 1. **날짜 확인**
   - 날짜가 명시되지 않으면 오늘 날짜 사용 (YYYY-MM-DD 형식)
   - 오늘 데이터가 없으면 데이터가 있는 최근 날짜 자동 선택 (질문 없이)

### 2. **데이터 파일 확인**
   - `data/tradings/날짜.xlsx` 존재 확인
   - `data/orders/날짜.xlsx` 존재 확인
   - 둘 중 하나라도 없으면 에러 알림

### 3. **거래 데이터 분석 (tradings)**
   - `data/tradings/날짜.xlsx` 파일 읽기
   - 거래 타입 분류:
     * **데이트레이딩**: 금일 매수량 > 0 AND 금일 매도량 > 0 (당일 매수/매도 모두 발생)
     * **스윙투자**: 금일 매수량 == 0 (또는 없음) AND 금일 매도량 > 0 (이전에 매수한 종목을 오늘 매도)
     * **매수만**: 금일 매수량 > 0 AND 금일 매도량 == 0 (매수만 하고 보유 중) - 분석 제외
   - **중요: 손익금액은 반드시 tradings 파일의 "손익금액" 필드 값 사용**
     * 이 값은 이미 수수료와 세금이 반영된 금액임
     * 별도로 수수료/세금 계산하지 않음

### 4. **체결 데이터 분석 (orders)**
   - `data/orders/날짜.xlsx` 파일 읽기
   - 모든 거래 종목(데이트레이딩 + 스윙투자)의 체결 내역 추출
   - 각 종목별로 다음 정보 계산:
     * 진입시간:
       - 데이트레이딩: 당일 첫 매수 체결 시간 (HH:MM:SS)
       - 스윙투자: 빈 값 (이전 날짜 매수이므로 당일 정보 없음)
     * 종료시간: 마지막 매도 체결 시간 (HH:MM:SS)
     * 보유시간:
       - 데이트레이딩: 첫 매수 ~ 마지막 매도 시간 차이 (Xh Ym 형식)
       - 스윙투자: 첫 매도 ~ 마지막 매도 시간 차이 (Xh Ym 형식)
     * 분할 매수 횟수: 당일 매수 체결 건수 (스윙투자는 0회)
     * 분할 매도 횟수: 당일 매도 체결 건수
     * 총 매도금액: orders 파일에서 체결가 × 체결량 합계

### 5. **종목 정보 수집**
   - 투자한 각 종목에 대해 **분석 날짜 기준**의 시가총액과 거래대금 수집
   - **중요: 과거 날짜 분석 시에도 해당 날짜의 데이터를 가져와야 함**
   - **pykrx 라이브러리 사용 (한국거래소 공식 데이터)**

   **사용 방법:**
   ```python
   from pykrx import stock

   # 날짜 형식: YYYYMMDD (예: "20251104")
   target_date = "20251104"
   stock_code = "098460"

   # 시가총액과 거래대금 가져오기
   df = stock.get_market_cap_by_date(target_date, target_date, stock_code)

   if not df.empty:
       market_cap = df.iloc[0, 0]      # 시가총액 (원)
       trading_value = df.iloc[0, 2]   # 거래대금 (원)

       # 억원 단위로 변환
       market_cap_uk = int(market_cap / 100000000)
       trading_value_uk = int(trading_value / 100000000)
   ```

   **데이터 상세:**
   - 반환값: DataFrame with columns ['시가총액', '거래량', '거래대금', '상장주식수']
   - 시가총액: 해당 날짜의 시가총액 (원 단위)
   - 거래대금: 해당 날짜의 거래대금 (원 단위)
   - 변환: 원 ÷ 100,000,000 = 억원

   **저장 형식:**
   - 시가총액: 억원 단위 (정수)
   - 거래대금: 억원 단위 (정수)
   - 예:
     * 시가총액 1,171,936,667,850원 → 11,719억
     * 거래대금 27,918,336,435원 → 279억

   **오류 처리:**
   - 해당 날짜 데이터가 없는 경우 (주말, 공휴일 등): 0으로 설정
   - 라이브러리 오류 시: 0으로 설정
   - 네트워크 오류 시: 재시도 1회, 실패 시 0으로 설정

### 6. **리포트 생성**
   - `report/tradings/날짜.md` 파일 생성 (기존 파일 있으면 덮어쓰기)
   - 리포트 포함 내용:

   **A. 전체 거래 현황**
   - 총 거래 건수 (데이트레이딩 + 스윙투자 합계)
   - 총 매입금액 (당일 매입금액)
   - 총 매도금액 (당일 매도금액)
   - 총 손익금액
   - 평균 수익률

   **A-1. 거래 타입별 수익 현황**
   - 데이트레이딩: 건수 및 손익금액
   - 스윙투자: 건수 및 손익금액

   **B. 수익/손실 분류**
   - 수익 거래 건수 및 금액
   - 손실 거래 건수 및 금액

   **C. 거래별 손익 상세 테이블** (반드시 포함!)
   - 순위: 수익률 순으로 정렬
   - 종목명
   - 거래타입: "데이트레이딩" 또는 "스윙투자"
   - 시작시간:
     * 데이트레이딩: 당일 첫 매수 체결 시간 (HH:MM:SS)
     * 스윙투자: 빈 값 (공백)
   - 종료시간: 마지막 매도 체결 시간 (HH:MM:SS)
   - 보유시간: Xh Ym 형식 (예: 1h 27m)
   - 분할매수: X회 (스윙투자는 0회)
   - 분할매도: X회
   - 시총(억): 시가총액 (억원 단위, 정수로 표시, 예: 13,800)
   - 거래대금(억): 거래대금 (억원 단위, 정수로 표시, 예: 2,563)
   - 매입금액:
     * 데이트레이딩: orders 파일에서 매수 체결가 × 체결량 합계
     * 스윙투자: 매도금액 - 손익금액으로 계산 (역산)
   - 매도금액: orders 파일에서 매도 체결가 × 체결량 합계
   - 손익금액: **반드시 tradings 파일의 "손익금액" 필드 값 사용** (수수료/세금 이미 반영됨)
   - 수익률: tradings 파일의 "수익률" 필드 값 사용 (+3.43% 또는 -1.23% 형식)

   **D. 수익률 분석**
   - 수익률 상위 5개 거래 (또는 전체)
   - 수익률 하위 5개 거래 (또는 전체)

   **E. 매수/매도 체결 상세 테이블**
   - 각 종목별로 매수 체결 내역 테이블
   - 각 종목별로 매도 체결 내역 테이블

### 7. **자동 Git 커밋**
   - 생성된 리포트 파일 git add
   - 커밋 메시지: "feat: Add day trading analysis for YYYY-MM-DD"

---

## 📤 결과물

- `report/tradings/날짜.md` - 데이트레이딩 분석 리포트

---

*🤖 Generated with Claude Code*
