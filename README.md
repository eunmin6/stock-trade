# 📊 주식 포트폴리오 분석 도구

주식 보유 현황을 분석하고 시각화하는 Python 도구입니다.

## 🚀 주요 기능

- **포트폴리오 분석**: 전체 수익률, 종목별 손익 등 상세 분석
- **매도 거래 분석**: 일일 매도 거래 내역과 손익 분석
- **뉴스 분석**: 네이버 뉴스 크롤링 및 호재/악재 자동 분석
- **급등종목 분석**: 인포스탁 데이터 기반 테마별 급등종목 자동 분류 및 리포트 생성
- **1년 추세 분석**: 개별 종목의 1년간 추세를 선형 회귀, 이동평균, 변동성으로 분석
- **투자 추천**: 급등종목 중 고점 리스크가 낮고 추가 상승 여력이 있는 종목 자동 선별
- **시각화**: 6개 차트로 포트폴리오 현황을 한눈에 파악
- **마크다운 리포트**: GitHub에서 바로 확인 가능한 리포트 생성
- **날짜별 관리**: 날짜별로 데이터와 리포트를 체계적으로 관리
- **신용/현금 통합**: 같은 종목의 신용/현금 투자를 자동으로 합산
- **정찰병 제외**: 보유 수량 1개인 정찰병 종목은 통계에서 제외

## 📁 프로젝트 구조

```
stock-trade/
├── code/                           # 분석 스크립트
│   ├── analyze_holdings.py         # 보유 종목 분석
│   ├── analyze_tradings.py         # 매도 거래 분석
│   ├── analyze_news_ultimate.py    # 뉴스 크롤링 및 감성 분석
│   ├── analyze_topgainers.py       # 급등종목 리포트 생성
│   └── analyze_stock_comprehensive.py  # 종합 주가 분석 (기술적 분석)
├── data/                           # 데이터 폴더 (gitignore)
│   └── YYYY-MM-DD/
│       ├── holdings.xlsx           # 날짜별 보유 종목 데이터
│       ├── tradings.xlsx           # 날짜별 매도 거래 데이터
│       └── topgainers.html         # 급등종목 HTML (인포스탁)
├── report/                         # 리포트 출력 폴더
│   ├── holdings/
│   │   ├── YYYY-MM-DD.md          # 보유 종목 리포트
│   │   └── img/YYYY-MM-DD.png     # 보유 종목 차트
│   ├── tradings/
│   │   ├── YYYY-MM-DD.md          # 매도 거래 리포트
│   │   └── img/YYYY-MM-DD.png     # 매도 거래 차트
│   ├── topgainers/
│   │   └── YYYY-MM-DD.md          # 급등종목 분석 리포트
│   ├── news/
│   │   └── 종목명_YYYY-MM-DD.md   # 종목별 뉴스 분석
│   └── analysis/
│       └── 종목명_YYYY-MM-DD.md   # 종합 투자 분석 리포트
├── requirements.txt               # 필요한 Python 패키지
└── README.md                      # 프로젝트 설명서
```

## 🛠️ 설치 방법

1. 저장소 클론
```bash
git clone https://github.com/eunmin6/stock-trade.git
cd stock-trade
```

2. 가상환경 생성 및 활성화 (선택사항)
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

3. 필요한 패키지 설치
```bash
pip install -r requirements.txt
```

## 📊 사용 방법

### 1. 보유 종목 분석

1. **데이터 준비**: `data/YYYY-MM-DD/holdings.xlsx` 형식으로 엑셀 파일 배치

2. **분석 실행**:
```bash
# 오늘 날짜 데이터 분석
python code/analyze_holdings.py

# 특정 날짜 데이터 분석
python code/analyze_holdings.py 2025-11-03
```

3. **결과 확인**: `report/holdings/` 폴더에서 결과 확인
   - `YYYY-MM-DD.md`: 마크다운 리포트
   - `img/YYYY-MM-DD.png`: 시각화 차트

### 2. 매도 거래 분석

1. **데이터 준비**: `data/YYYY-MM-DD/tradings.xlsx` 형식으로 엑셀 파일 배치

2. **분석 실행**:
```bash
# 오늘 날짜 데이터 분석
python code/analyze_tradings.py

# 특정 날짜 데이터 분석
python code/analyze_tradings.py 2025-11-03
```

3. **결과 확인**: `report/tradings/` 폴더에서 결과 확인
   - `YYYY-MM-DD.md`: 마크다운 리포트
   - `img/YYYY-MM-DD.png`: 시각화 차트

### 3. 뉴스 분석

#### 3-1. 뉴스 자동 수집 및 분류

1. **분석 실행**:
```bash
# 종목명으로 뉴스 분석 (최근 14일)
python code/analyze_news_ultimate.py "삼성전자"
python code/analyze_news_ultimate.py "SK하이닉스"
python code/analyze_news_ultimate.py "일동제약"
```

2. **자동 분석 내용**:
   - Google News RSS + Naver News 크롤링 (최근 14일)
   - 호재/악재/중립 자동 분류
   - 각 뉴스별 영향도(⭐) 자동 평가
   - 키워드 빈도 기반 중요도 산정

3. **결과 확인**: `report/news/종목명_YYYY-MM-DD.md`

#### 3-2. 뉴스 핵심 요약 추가 (Claude Code)

**목적**: 자동 생성된 뉴스 리포트에 전문적인 요약과 투자 인사이트 추가

**Claude Code 프롬프트 예시**:
```
두산로보틱스 뉴스를 검색한 후 내용을 정리해서 상단에 작성해줘.
```

또는

```
[종목명] 뉴스 파일을 읽고 핵심 내용을 요약해서 상단에 추가해줘.
```

**요약 구성**:

1. **🎯 핵심 요약**
   - **주요 이슈**: 한 줄 핵심 정리
   - **3줄 요약**: 가장 중요한 3가지 내용

2. **🔥 핵심 모멘텀**
   - 각 모멘텀별 상세 분석 (중요도 ⭐⭐⭐ 표시)
   - 협력/제휴 내용 구체화
   - 시장 영향 분석
   - 주가 변동 요인 설명

3. **⚠️ 주의 사항**
   - 고점 리스크 여부
   - 모멘텀 지속성 평가
   - 실적 검증 필요성

4. **🎯 투자 포인트**
   - **강점**: 호재 요소 정리
   - **리스크**: 위험 요소 정리
   - **투자 전략**: 구체적 매수/대기/회피 전략 제시

**분석 예시**:

```markdown
## 🎯 핵심 요약

### 📈 주요 이슈
**두산로보틱스, 에이딘로보틱스와 피지컬 AI 휴머노이드 공동 개발 + 엔비디아 협력 수혜로 급등**

### 💡 3줄 요약
1. **피지컬 AI 협력**: 에이딘로보틱스와 양팔형 휴머노이드 로봇 공동 개발 MOU 체결
2. **주가 급등**: 11월 3일 +18.08% 폭등, 엔비디아 협력 기대감
3. **모회사 효과**: 두산 주가 101만원 '황제주' 등극

### 🔥 핵심 모멘텀
#### 1. 피지컬 AI 휴머노이드 개발 협력 (⭐⭐⭐)
- 협력사: 에이딘로보틱스 (정밀 센서 전문)
- 협력 내용: 로봇팔 + 센싱 기술 결합
- 시장 의미: 차세대 지능형 로봇 개발 가속화
```

**출력 위치**:
- 기존 `## 📊 요약` 섹션 위에 `## 🎯 핵심 요약` 추가
- 파일: `report/YYYY-MM-DD/news/news_종목명.md`

**활용 시나리오**:
1. **급등 종목 뉴스 확인**: 급등종목 분석 후 관심 종목 뉴스 수집 → 핵심 요약 요청
2. **보유 종목 모니터링**: 보유 종목의 최신 뉴스 트렌드 파악 → 투자 전략 재검토
3. **신규 매수 검토**: 매수 고려 종목의 뉴스 분석 → 호재/악재 종합 판단

### 4. 급등종목 분석

#### 4-1. 급등종목 리포트 생성

1. **HTML 데이터 준비**:
   - 인포스탁 증시요약 페이지에서 해당 날짜의 급등종목 페이지를 HTML로 저장
   - 저장 위치: `data/YYYY-MM-DD/topgainers.html`

2. **분석 실행**:
```bash
# 특정 날짜의 급등종목 분석
python code/analyze_topgainers.py 2025-11-03

# 가상환경 사용 시
./venv/Scripts/python code/analyze_topgainers.py 2025-11-03
```

3. **결과 확인**: `report/topgainers/YYYY-MM-DD.md`
   - 주요 급등 테마 분석 (키워드 기반 자동 분류)
   - 시장 분석 (평균 상승률, 최고 상승률)
   - 상한가 종목 테이블 (거래대금 500억원 이상)
   - 급등종목 TOP 테이블 (상한가 제외, 거래대금 500억원 이상)

#### 4-2. 급등종목 1년 추세 분석 및 투자 추천

**목적**: 급등종목 중 고점 리스크가 낮고 추가 상승 여력이 있는 종목 선별

**Claude Code 프롬프트 예시**:
```
일동제약 종목 뉴스 분석과 기술적 분석 진행해줘.
```

이 명령은 자동으로:
1. 뉴스 수집 (`code/analyze_news_ultimate.py` 실행)
2. 기술적 분석 (`code/analyze_stock_comprehensive.py` 실행)
3. 종합 리포트 생성 (`report/analysis/종목명_YYYY-MM-DD.md`)
4. GitHub 커밋

**선정 기준**:

1. **✅ 투자 추천 종목 (5개)**
   - 조건 1: **우상향 패턴 명확** (R² ≥ 0.3, 선형 회귀 추세 강도)
   - 조건 2: **고점 대비 여유** (현재가가 1년 최고가의 95% 미만)
   - 조건 3: **최근 모멘텀 양호** (최근 20일 수익률 > 0% 또는 조정 후 재상승)
   - 조건 4: **1년 최저가 대비 상승률 100% 이상**
   - 분석 항목: 현재가, 1년 최저가 대비 상승률, 최고가 대비 여유, 추세 강도(R²), 최근 20일 수익률, 추천 이유

2. **⚠️ 주의 종목 (고점 리스크)**
   - 조건: **현재가가 1년 최고가의 95% 이상** 또는 최고가 도달
   - 위험 요인: 단기 급등 (최근 20일 수익률 50% 이상), 변동성 과도 (일별 변동성 5% 이상)
   - 권장 전략: **5~15% 조정 후 재진입 대기**

3. **❌ 투자 부적합 종목**
   - 조건 1: **우상향 추세 부재** (R² < 0.3)
   - 조건 2: **하락 추세** (1년 추세 기울기 < 0)
   - 조건 3: **데이터 부족** (상장 첫날 등)
   - 사유: 변동성만 높고 방향성 불명확, 또는 장기 하락세

**분석 도구**: `code/analyze_stock_comprehensive.py`
```bash
# 개별 종목 종합 분석
python code/analyze_stock_comprehensive.py "일동제약"
python code/analyze_stock_comprehensive.py "249420"  # 종목코드로도 가능
```

**출력 정보**:
- 1년 최저가/최고가/평균가
- 1년 최저가 대비 상승률, 평균가 대비 상승률, 3개월 전 대비 상승률
- 선형 회귀 추세 분석 (기울기, R² 추세 강도, 우상향 패턴 여부)
- 이동평균선 분석 (20일/60일/200일, 골든크로스/데드크로스)
- 변동성 분석 (일별 변동성, 상승/하락 일수)
- 최근 20일 모멘텀 (급등/상승/보합/하락/급락)

**투자 전략 제언**:
- 🟢 **지금 투자 고려 가능**: 우상향 추세 + 고점 대비 여유 + 강한 모멘텀
- 🟡 **조정 후 재진입 대기**: 고점 근접 + 단기 과열 신호
- 🔴 **투자 회피**: 추세 부재 + 변동성만 높음

**분석 결과 위치**: `report/YYYY-MM-DD/topgainers.md` 파일 맨 밑에 자동 추가

## 📈 출력 예시

### 시각화 차트 (holdings.png)
- 수익/손실 비율 (파이 차트)
- 종목별 비중 (파이 차트)
- 수익률 상위/하위 종목 (바 차트)
- 전체 종목 평가손익 (바 차트)
- 매입금액 vs 평가금액 (산점도)
- 포트폴리오 요약 통계
- **종목별 수익/손실 상세 테이블**

### 마크다운 리포트 (holdings.md)
- 전체 포트폴리오 현황
- 수익/손실 분류
- 종목별 수익/손실 상세 테이블
- 수익률 분석 (상위/하위 5개)
- 포트폴리오 비중
- 신용거래 현황

## 📋 필요한 패키지

- pandas >= 2.3.3
- openpyxl >= 3.1.5
- matplotlib >= 3.10.7
- seaborn >= 0.13.2
- numpy >= 2.3.4
- requests >= 2.32.5
- beautifulsoup4 >= 4.14.2
- lxml >= 6.0.2
- pykrx >= 1.0.47 (한국거래소 데이터 조회)
- scipy >= 1.15.3 (선형 회귀 분석)

## 🔒 개인정보 보호

- `data/` 폴더는 `.gitignore`에 포함되어 개인 거래 데이터가 저장소에 올라가지 않습니다.
- 리포트는 선택적으로 공유할 수 있습니다.

## 🤖 개발 도구

이 프로젝트는 [Claude Code](https://claude.com/claude-code)를 사용하여 개발되었습니다.

## 📝 라이선스

MIT License
